{"highlights":[{"content_html":"<h1>PARTS:</h1>\n<ol>\n<li><a href=\"/posts/weather-ai-part-1.html\">Ideas &amp; Looking At The Data</a></li>\n</ol>","metadata":{"date":"Tue, 08 Apr 2025 00:00:00 GMT","slug":"weather-ai","title":"Weather Forecasting"},"slug":"weather-ai"}],"posts":[{"content_html":"<p>You can read the previous part <a href=\"weather-ai-part-1.html\">here</a>.</p>\n<h1>Overview:</h1>\n<p>Last time was a disaster as I realised that I had naively thrown together code, without knowing much. We were also missing the most important variables, i.e, <strong>total precipitation (tc)</strong> and <strong>total cloud cover (tcc)</strong>. As I explored the data, I ran into numerous errors and weird quirks (which was made worse by being lazy and using AI, to fix the errors, so I stopped using it midway).<br />\nIn this post I'd like to go through all the errors in chronological order (the order in which I ran into them), and finally get to writing helper functions for plotting/visualizing the data.</p>\n<p><br></p>\n<h1>The Right Data:</h1>\n<p>Okay, so having data spaced at <strong>4 hour intervals</strong>, for a nowcasting project, was far from ideal. So instead I decided to take only 1 month of data but have complete hourly data.\nI also included <strong>total precipitation (tp)</strong>, <strong>total cloud cover (tcc)</strong>, and <strong>geopotential (z)</strong> (because we might need it to augment the model with topological data contraints, but we'll see).\nI also switched to <strong>GRIB</strong> instead of <strong>NetCDF</strong>, the reasons are as you will see ahead.</p>\n<p>Also we needed the best month to get the data from, with plenty of activity going on, so I picked <strong>July 2024</strong>.</p>\n<p>So the final download request looked like:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">cdsapi</span>\n\n<span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;reanalysis-era5-single-levels&quot;</span>\n<span class=\"n\">request</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"s2\">&quot;product_type&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"s2\">&quot;reanalysis&quot;</span><span class=\"p\">],</span>\n    <span class=\"s2\">&quot;variable&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"s2\">&quot;2m_temperature&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;10m_u_component_of_wind&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;10m_v_component_of_wind&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;relative_humidity&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;total_precipitation&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;surface_pressure&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;total_cloud_cover&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;geopotential&quot;</span>\n    <span class=\"p\">],</span>\n    <span class=\"s2\">&quot;year&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"s2\">&quot;2024&quot;</span><span class=\"p\">],</span>\n    <span class=\"s2\">&quot;month&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"s2\">&quot;07&quot;</span><span class=\"p\">],</span>\n    <span class=\"s2\">&quot;day&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"s2\">&quot;01&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;02&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;03&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;04&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;05&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;06&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;07&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;08&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;09&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;10&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;11&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;12&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;13&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;14&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;15&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;16&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;17&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;18&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;19&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;20&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;21&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;22&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;23&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;24&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;25&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;26&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;27&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;28&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;29&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;30&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;31&quot;</span>\n    <span class=\"p\">],</span>\n    <span class=\"s2\">&quot;time&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"s2\">&quot;00:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;01:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;02:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;03:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;04:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;05:00&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;06:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;07:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;08:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;09:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;10:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;11:00&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;12:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;13:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;14:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;15:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;16:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;17:00&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;18:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;19:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;20:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;21:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;22:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;23:00&quot;</span>\n    <span class=\"p\">],</span>\n    <span class=\"s2\">&quot;data_format&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;grib&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;download_format&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;unarchived&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;area&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;global&quot;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">client</span> <span class=\"o\">=</span> <span class=\"n\">cdsapi</span><span class=\"o\">.</span><span class=\"n\">Client</span><span class=\"p\">()</span>\n<span class=\"n\">client</span><span class=\"o\">.</span><span class=\"n\">retrieve</span><span class=\"p\">(</span><span class=\"n\">dataset</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">download</span><span class=\"p\">()</span>\n</code></pre></div>\n\n<p>(I saved the file as <code>era5_july2024_global_hourly.grib</code>)    </p>\n<p><br></p>\n<h1>Problem 1: Heterogenous Data</h1>\n<p>I didn't know the structure of the data I was using, so it was quite the headache to figure stuff out. I did come across this website: <a href=\"https://codes.ecmwf.int/grib/param-db/\">ECMWF Parameter Database</a>. But It was already too late. </p>\n<p>(NOTE: the next part is before I switched to GRIB)</p>\n<p>So excited to try out the new dataset, I did:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">xarray</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nn\">xr</span>\n\n<span class=\"c1\"># Load the NetCDF file</span>\n<span class=\"n\">ds</span> <span class=\"o\">=</span> <span class=\"n\">xr</span><span class=\"o\">.</span><span class=\"n\">open_dataset</span><span class=\"p\">(</span><span class=\"s2\">&quot;era5_july2024_global_hourly.nc&quot;</span><span class=\"p\">,</span> <span class=\"n\">engine</span><span class=\"o\">=</span><span class=\"s2\">&quot;netcdf4&quot;</span><span class=\"p\">)</span>\n\n<span class=\"c1\"># Print the dataset summary</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">ds</span><span class=\"p\">)</span>\n</code></pre></div>\n\n<p>and gracefully got the error:</p>\n<div class=\"error-block\">\n<details>\n<summary>OSError: NetCDF: Unknown file format</summary>\n<pre>\n---------------------------------------------------------------------------\nKeyError                                  Traceback (most recent call last)\nFile c:\\Users\\*****\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\xarray\\backends\\file_manager.py:211, in CachingFileManager._acquire_with_cache_info(self, needs_lock)\n    210 try:\n--> 211     file = self._cache[self._key]\n    212 except KeyError:\n\nFile c:\\Users\\*****\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\xarray\\backends\\lru_cache.py:56, in LRUCache.__getitem__(self, key)\n    55 with self._lock:\n---> 56     value = self._cache[key]\n    57     self._cache.move_to_end(key)\n\nKeyError: [<class 'netCDF4._netCDF4.Dataset'>, ('c:\\\\dev\\\\weather\\\\era5_july2024_global_hourly.nc',), 'r', (('clobber', True), ('diskless', False), ('format', 'NETCDF4'), ('persist', False)), 'df0025b7-69bf-4128-8320-5d00cce38840']\n\nDuring handling of the above exception, another exception occurred:\n\nOSError                                   Traceback (most recent call last)\nCell In[4], line 4\n    1 import xarray as xr\n    3 # Load the NetCDF file\n----> 4 ds = xr.open_dataset(\"era5_july2024_global_hourly.nc\", engine=\"netcdf4\")\n    6 # Print the dataset summary\n    7 print(ds)\n\nFile c:\\Users\\*****\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\xarray\\backends\\api.py:687, in open_dataset(filename_or_obj, engine, chunks, cache, decode_cf, mask_and_scale, decode_times, decode_timedelta, use_cftime, concat_characters, decode_coords, drop_variables, inline_array, chunked_array_type, from_array_kwargs, backend_kwargs, **kwargs)\n    675 decoders = _resolve_decoders_kwargs(\n    676     decode_cf,\n    677     open_backend_dataset_parameters=backend.open_dataset_parameters,\n(...)\n    683     decode_coords=decode_coords,\n    684 )\n    686 overwrite_encoded_chunks = kwargs.pop(\"overwrite_encoded_chunks\", None)\n--> 687 backend_ds = backend.open_dataset(\n    688     filename_or_obj,\n    689     drop_variables=drop_variables,\n    690     **decoders,\n    691     **kwargs,\n    692 )\n    693 ds = _dataset_from_backend_dataset(\n    694     backend_ds,\n    695     filename_or_obj,\n(...)\n    705     **kwargs,\n    706 )\n    707 return ds\n\nFile c:\\Users\\*****\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\xarray\\backends\\netCDF4_.py:666, in NetCDF4BackendEntrypoint.open_dataset(self, filename_or_obj, mask_and_scale, decode_times, concat_characters, decode_coords, drop_variables, use_cftime, decode_timedelta, group, mode, format, clobber, diskless, persist, auto_complex, lock, autoclose)\n    644 def open_dataset(\n    645     self,\n    646     filename_or_obj: str | os.PathLike[Any] | ReadBuffer | AbstractDataStore,\n(...)\n    663     autoclose=False,\n    664 ) -> Dataset:\n    665     filename_or_obj = _normalize_path(filename_or_obj)\n--> 666     store = NetCDF4DataStore.open(\n    667         filename_or_obj,\n    668         mode=mode,\n    669         format=format,\n    670         group=group,\n    671         clobber=clobber,\n    672         diskless=diskless,\n    673         persist=persist,\n    674         auto_complex=auto_complex,\n    675         lock=lock,\n    676         autoclose=autoclose,\n    677     )\n    679     store_entrypoint = StoreBackendEntrypoint()\n    680     with close_on_error(store):\n\nFile c:\\Users\\*****\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\xarray\\backends\\netCDF4_.py:452, in NetCDF4DataStore.open(cls, filename, mode, format, group, clobber, diskless, persist, auto_complex, lock, lock_maker, autoclose)\n    448     kwargs[\"auto_complex\"] = auto_complex\n    449 manager = CachingFileManager(\n    450     netCDF4.Dataset, filename, mode=mode, kwargs=kwargs\n    451 )\n--> 452 return cls(manager, group=group, mode=mode, lock=lock, autoclose=autoclose)\n\nFile c:\\Users\\*****\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\xarray\\backends\\netCDF4_.py:393, in NetCDF4DataStore.__init__(self, manager, group, mode, lock, autoclose)\n    391 self._group = group\n    392 self._mode = mode\n--> 393 self.format = self.ds.data_model\n    394 self._filename = self.ds.filepath()\n    395 self.is_remote = is_remote_uri(self._filename)\n\nFile c:\\Users\\*****\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\xarray\\backends\\netCDF4_.py:461, in NetCDF4DataStore.ds(self)\n    459 @property\n    460 def ds(self):\n--> 461     return self._acquire()\n\nFile c:\\Users\\*****\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\xarray\\backends\\netCDF4_.py:455, in NetCDF4DataStore._acquire(self, needs_lock)\n    454 def _acquire(self, needs_lock=True):\n--> 455     with self._manager.acquire_context(needs_lock) as root:\n    456         ds = _nc4_require_group(root, self._group, self._mode)\n    457     return ds\n\nFile c:\\Users\\*****\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\contextlib.py:137, in _GeneratorContextManager.__enter__(self)\n    135 del self.args, self.kwds, self.func\n    136 try:\n--> 137     return next(self.gen)\n    138 except StopIteration:\n    139     raise RuntimeError(\"generator didn't yield\") from None\n\nFile c:\\Users\\*****\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\xarray\\backends\\file_manager.py:199, in CachingFileManager.acquire_context(self, needs_lock)\n    196 @contextlib.contextmanager\n    197 def acquire_context(self, needs_lock=True):\n    198     \"\"\"Context manager for acquiring a file.\"\"\"\n--> 199     file, cached = self._acquire_with_cache_info(needs_lock)\n    200     try:\n    201         yield file\n\nFile c:\\Users\\*****\\AppData\\Local\\Programs\\Python\\Python312\\Lib\\site-packages\\xarray\\backends\\file_manager.py:217, in CachingFileManager._acquire_with_cache_info(self, needs_lock)\n    215     kwargs = kwargs.copy()\n    216     kwargs[\"mode\"] = self._mode\n--> 217 file = self._opener(*self._args, **kwargs)\n    218 if self._mode == \"w\":\n    219     # ensure file doesn't get overridden when opened again\n    220     self._mode = \"a\"\n\nFile src\\\\netCDF4\\\\_netCDF4.pyx:2521, in netCDF4._netCDF4.Dataset.__init__()\n\nFile src\\\\netCDF4\\\\_netCDF4.pyx:2158, in netCDF4._netCDF4._ensure_nc_success()\n\n**OSError: [Errno -51] NetCDF: Unknown file format: 'c:\\\\dev\\\\weather\\\\era5_july2024_global_hourly.nc'**\n\n</pre>\n</details>\n</div>\n\n<p>I should be crying (did) but I thought \"maybe the download got corrupted\". So I tried about thrice just to make sure... But that wasn't it. </p>\n<p>So the thing is- <strong>This did not happen with the original test dataset</strong>. Which troubled me to no end. I speculated that one of the variables messed up the data, so after several tries selectively removing and downloading and testing, I narrowed the suspect down to <strong>Total Percipitation (tp)</strong>. (This did take a lot of time as the datasets weren't small ~19GB).</p>\n<p>Then I noticed that the ERA5 website says that the NetCDF version is \"experimental\". So I switched over to the <strong>GRIB</strong> format. \nQuite conviniently a library called <code>cfgrib</code> is available, and also works with xarray.</p>\n<p>So I tried again with the GRIB version:   </p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">xarray</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nn\">xr</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">numpy</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nn\">np</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">pandas</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nn\">pd</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">os</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">matplotlib.pyplot</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nn\">plt</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">cfgrib</span>\n\n<span class=\"n\">grib_ds</span> <span class=\"o\">=</span> <span class=\"n\">xr</span><span class=\"o\">.</span><span class=\"n\">open_dataset</span><span class=\"p\">(</span><span class=\"s2\">&quot;era5_july2024_global_hourly.grib&quot;</span><span class=\"p\">,</span> <span class=\"n\">engine</span><span class=\"o\">=</span><span class=\"s2\">&quot;cfgrib&quot;</span><span class=\"p\">)</span>\n<span class=\"n\">grib_ds</span>\n</code></pre></div>\n\n<p>It didn't work, But more importantly it showed something really insightful:</p>\n<div class=\"error-block\">\n<details>\n<summary>Skipping variable: paramId==228 shortName='tp'</summary>\n<pre>\nskipping variable: paramId==228 shortName='tp'\nTraceback (most recent call last):\n  File \"c:\\Users\\*****\\anaconda3\\envs\\era5_env\\Lib\\site-packages\\cfgrib\\dataset.py\", line 725, in build_dataset_components\n    dict_merge(variables, coord_vars)\n  File \"c:\\Users\\*****\\anaconda3\\envs\\era5_env\\Lib\\site-packages\\cfgrib\\dataset.py\", line 641, in dict_merge\n    raise DatasetBuildError(\ncfgrib.dataset.DatasetBuildError: key present and new value is different: key='time' value=Variable(dimensions=('time',), data=array([1719792000, 1719795600, 1719799200, 1719802800, 1719806400,\n       1719810000, 1719813600, 1719817200, 1719820800, 1719824400,\n       1719828000, 1719831600, 1719835200, 1719838800, 1719842400,\n       1719846000, 1719849600, 1719853200, 1719856800, 1719860400,\n       1719864000, 1719867600, 1719871200, 1719874800, 1719878400,\n       1719882000, 1719885600, 1719889200, 1719892800, 1719896400,\n       1719900000, 1719903600, 1719907200, 1719910800, 1719914400,\n       1719918000, 1719921600, 1719925200, 1719928800, 1719932400,\n       1719936000, 1719939600, 1719943200, 1719946800, 1719950400,\n       1719954000, 1719957600, 1719961200, 1719964800, 1719968400,\n       1719972000, 1719975600, 1719979200, 1719982800, 1719986400,\n       1719990000, 1719993600, 1719997200, 1720000800, 1720004400,\n       1720008000, 1720011600, 1720015200, 1720018800, 1720022400,\n       1720026000, 1720029600, 1720033200, 1720036800, 1720040400,\n       1720044000, 1720047600, 1720051200, 1720054800, 1720058400,\n       1720062000, 1720065600, 1720069200, 1720072800, 1720076400,\n       1720080000, 1720083600, 1720087200, 1720090800, 1720094400,\n       1720098000, 1720101600, 1720105200, 1720108800, 1720112400,\n       1720116000, 1720119600, 1720123200, 1720126800, 1720130400,\n       1720134000, 1720137600, 1720141200, 1720144800, 1720148400,\n       1720152000, 1720155600, 1720159200, 1720162800, 1720166400,\n       1720170000, 1720173600, 1720177200, 1720180800, 1720184400,\n       1720188000, 1720191600, 1720195200, 1720198800, 1720202400,\n       1720206000, 1720209600, 1720213200, 1720216800, 1720220400,\n       1720224000, 1720227600, 1720231200, 1720234800, 1720238400,\n       1720242000, 1720245600, 1720249200, 1720252800, 1720256400,\n       1720260000, 1720263600, 1720267200, 1720270800, 1720274400,\n       1720278000, 1720281600, 1720285200, 1720288800, 1720292400,\n       1720296000, 1720299600, 1720303200, 1720306800, 1720310400,\n       1720314000, 1720317600, 1720321200, 1720324800, 1720328400,\n       1720332000, 1720335600, 1720339200, 1720342800, 1720346400,\n       1720350000, 1720353600, 1720357200, 1720360800, 1720364400,\n       1720368000, 1720371600, 1720375200, 1720378800, 1720382400,\n       1720386000, 1720389600, 1720393200, 1720396800, 1720400400,\n       1720404000, 1720407600, 1720411200, 1720414800, 1720418400,\n       1720422000, 1720425600, 1720429200, 1720432800, 1720436400,\n       1720440000, 1720443600, 1720447200, 1720450800, 1720454400,\n       1720458000, 1720461600, 1720465200, 1720468800, 1720472400,\n       1720476000, 1720479600, 1720483200, 1720486800, 1720490400,\n       1720494000, 1720497600, 1720501200, 1720504800, 1720508400,\n       1720512000, 1720515600, 1720519200, 1720522800, 1720526400,\n       1720530000, 1720533600, 1720537200, 1720540800, 1720544400,\n       1720548000, 1720551600, 1720555200, 1720558800, 1720562400,\n       1720566000, 1720569600, 1720573200, 1720576800, 1720580400,\n       1720584000, 1720587600, 1720591200, 1720594800, 1720598400,\n       1720602000, 1720605600, 1720609200, 1720612800, 1720616400,\n       1720620000, 1720623600, 1720627200, 1720630800, 1720634400,\n       1720638000, 1720641600, 1720645200, 1720648800, 1720652400,\n       1720656000, 1720659600, 1720663200, 1720666800, 1720670400,\n       1720674000, 1720677600, 1720681200, 1720684800, 1720688400,\n       1720692000, 1720695600, 1720699200, 1720702800, 1720706400,\n       1720710000, 1720713600, 1720717200, 1720720800, 1720724400,\n       1720728000, 1720731600, 1720735200, 1720738800, 1720742400,\n       1720746000, 1720749600, 1720753200, 1720756800, 1720760400,\n       1720764000, 1720767600, 1720771200, 1720774800, 1720778400,\n       1720782000, 1720785600, 1720789200, 1720792800, 1720796400,\n       1720800000, 1720803600, 1720807200, 1720810800, 1720814400,\n       1720818000, 1720821600, 1720825200, 1720828800, 1720832400,\n       1720836000, 1720839600, 1720843200, 1720846800, 1720850400,\n       1720854000, 1720857600, 1720861200, 1720864800, 1720868400,\n       1720872000, 1720875600, 1720879200, 1720882800, 1720886400,\n       1720890000, 1720893600, 1720897200, 1720900800, 1720904400,\n       1720908000, 1720911600, 1720915200, 1720918800, 1720922400,\n       1720926000, 1720929600, 1720933200, 1720936800, 1720940400,\n       1720944000, 1720947600, 1720951200, 1720954800, 1720958400,\n       1720962000, 1720965600, 1720969200, 1720972800, 1720976400,\n       1720980000, 1720983600, 1720987200, 1720990800, 1720994400,\n       1720998000, 1721001600, 1721005200, 1721008800, 1721012400,\n       1721016000, 1721019600, 1721023200, 1721026800, 1721030400,\n       1721034000, 1721037600, 1721041200, 1721044800, 1721048400,\n       1721052000, 1721055600, 1721059200, 1721062800, 1721066400,\n       1721070000, 1721073600, 1721077200, 1721080800, 1721084400,\n       1721088000, 1721091600, 1721095200, 1721098800, 1721102400,\n       1721106000, 1721109600, 1721113200, 1721116800, 1721120400,\n       1721124000, 1721127600, 1721131200, 1721134800, 1721138400,\n       1721142000, 1721145600, 1721149200, 1721152800, 1721156400,\n       1721160000, 1721163600, 1721167200, 1721170800, 1721174400,\n       1721178000, 1721181600, 1721185200, 1721188800, 1721192400,\n       1721196000, 1721199600, 1721203200, 1721206800, 1721210400,\n       1721214000, 1721217600, 1721221200, 1721224800, 1721228400,\n       1721232000, 1721235600, 1721239200, 1721242800, 1721246400,\n       1721250000, 1721253600, 1721257200, 1721260800, 1721264400,\n       1721268000, 1721271600, 1721275200, 1721278800, 1721282400,\n       1721286000, 1721289600, 1721293200, 1721296800, 1721300400,\n       1721304000, 1721307600, 1721311200, 1721314800, 1721318400,\n       1721322000, 1721325600, 1721329200, 1721332800, 1721336400,\n       1721340000, 1721343600, 1721347200, 1721350800, 1721354400,\n       1721358000, 1721361600, 1721365200, 1721368800, 1721372400,\n       1721376000, 1721379600, 1721383200, 1721386800, 1721390400,\n       1721394000, 1721397600, 1721401200, 1721404800, 1721408400,\n       1721412000, 1721415600, 1721419200, 1721422800, 1721426400,\n       1721430000, 1721433600, 1721437200, 1721440800, 1721444400,\n       1721448000, 1721451600, 1721455200, 1721458800, 1721462400,\n       1721466000, 1721469600, 1721473200, 1721476800, 1721480400,\n       1721484000, 1721487600, 1721491200, 1721494800, 1721498400,\n       1721502000, 1721505600, 1721509200, 1721512800, 1721516400,\n       1721520000, 1721523600, 1721527200, 1721530800, 1721534400,\n       1721538000, 1721541600, 1721545200, 1721548800, 1721552400,\n       1721556000, 1721559600, 1721563200, 1721566800, 1721570400,\n       1721574000, 1721577600, 1721581200, 1721584800, 1721588400,\n       1721592000, 1721595600, 1721599200, 1721602800, 1721606400,\n       1721610000, 1721613600, 1721617200, 1721620800, 1721624400,\n       1721628000, 1721631600, 1721635200, 1721638800, 1721642400,\n       1721646000, 1721649600, 1721653200, 1721656800, 1721660400,\n       1721664000, 1721667600, 1721671200, 1721674800, 1721678400,\n       1721682000, 1721685600, 1721689200, 1721692800, 1721696400,\n       1721700000, 1721703600, 1721707200, 1721710800, 1721714400,\n       1721718000, 1721721600, 1721725200, 1721728800, 1721732400,\n       1721736000, 1721739600, 1721743200, 1721746800, 1721750400,\n       1721754000, 1721757600, 1721761200, 1721764800, 1721768400,\n       1721772000, 1721775600, 1721779200, 1721782800, 1721786400,\n       1721790000, 1721793600, 1721797200, 1721800800, 1721804400,\n       1721808000, 1721811600, 1721815200, 1721818800, 1721822400,\n       1721826000, 1721829600, 1721833200, 1721836800, 1721840400,\n       1721844000, 1721847600, 1721851200, 1721854800, 1721858400,\n       1721862000, 1721865600, 1721869200, 1721872800, 1721876400,\n       1721880000, 1721883600, 1721887200, 1721890800, 1721894400,\n       1721898000, 1721901600, 1721905200, 1721908800, 1721912400,\n       1721916000, 1721919600, 1721923200, 1721926800, 1721930400,\n       1721934000, 1721937600, 1721941200, 1721944800, 1721948400,\n       1721952000, 1721955600, 1721959200, 1721962800, 1721966400,\n       1721970000, 1721973600, 1721977200, 1721980800, 1721984400,\n       1721988000, 1721991600, 1721995200, 1721998800, 1722002400,\n       1722006000, 1722009600, 1722013200, 1722016800, 1722020400,\n       1722024000, 1722027600, 1722031200, 1722034800, 1722038400,\n       1722042000, 1722045600, 1722049200, 1722052800, 1722056400,\n       1722060000, 1722063600, 1722067200, 1722070800, 1722074400,\n       1722078000, 1722081600, 1722085200, 1722088800, 1722092400,\n       1722096000, 1722099600, 1722103200, 1722106800, 1722110400,\n       1722114000, 1722117600, 1722121200, 1722124800, 1722128400,\n       1722132000, 1722135600, 1722139200, 1722142800, 1722146400,\n       1722150000, 1722153600, 1722157200, 1722160800, 1722164400,\n       1722168000, 1722171600, 1722175200, 1722178800, 1722182400,\n       1722186000, 1722189600, 1722193200, 1722196800, 1722200400,\n       1722204000, 1722207600, 1722211200, 1722214800, 1722218400,\n       1722222000, 1722225600, 1722229200, 1722232800, 1722236400,\n       1722240000, 1722243600, 1722247200, 1722250800, 1722254400,\n       1722258000, 1722261600, 1722265200, 1722268800, 1722272400,\n       1722276000, 1722279600, 1722283200, 1722286800, 1722290400,\n       1722294000, 1722297600, 1722301200, 1722304800, 1722308400,\n       1722312000, 1722315600, 1722319200, 1722322800, 1722326400,\n       1722330000, 1722333600, 1722337200, 1722340800, 1722344400,\n       1722348000, 1722351600, 1722355200, 1722358800, 1722362400,\n       1722366000, 1722369600, 1722373200, 1722376800, 1722380400,\n       1722384000, 1722387600, 1722391200, 1722394800, 1722398400,\n       1722402000, 1722405600, 1722409200, 1722412800, 1722416400,\n       1722420000, 1722423600, 1722427200, 1722430800, 1722434400,\n       1722438000, 1722441600, 1722445200, 1722448800, 1722452400,\n       1722456000, 1722459600, 1722463200, 1722466800])) new_value=Variable(dimensions=('time',), data=array([1719770400, 1719813600, 1719856800, 1719900000, 1719943200,\n       1719986400, 1720029600, 1720072800, 1720116000, 1720159200,\n       1720202400, 1720245600, 1720288800, 1720332000, 1720375200,\n       1720418400, 1720461600, 1720504800, 1720548000, 1720591200,\n       1720634400, 1720677600, 1720720800, 1720764000, 1720807200,\n       1720850400, 1720893600, 1720936800, 1720980000, 1721023200,\n       1721066400, 1721109600, 1721152800, 1721196000, 1721239200,\n       1721282400, 1721325600, 1721368800, 1721412000, 1721455200,\n       1721498400, 1721541600, 1721584800, 1721628000, 1721671200,\n       1721714400, 1721757600, 1721800800, 1721844000, 1721887200,\n       1721930400, 1721973600, 1722016800, 1722060000, 1722103200,\n       1722146400, 1722189600, 1722232800, 1722276000, 1722319200,\n       1722362400, 1722405600, 1722448800]))\n</pre>\n</details>\n</div>\n\n<p>That was it! it was <code>tp</code>. Furthermore, it showed me exactly why the data was different. It is because the <strong>timestamps are different</strong>. <code>tp</code> was different from the other variables, which made the dataset heterogenous and xarray was unable to load it. (xarray always assumes homogenous data, tried to merge it, and failed).\nSo what do we do? After some searching I realised that cfgrib has its own load function that can auto-detect the different datasets present in the file. Something like this:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">xarray</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nn\">xr</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">numpy</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nn\">np</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">pandas</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nn\">pd</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">os</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">matplotlib.pyplot</span><span class=\"w\"> </span><span class=\"k\">as</span><span class=\"w\"> </span><span class=\"nn\">plt</span>\n<span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">cfgrib</span>\n\n<span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"n\">cfgrib</span><span class=\"o\">.</span><span class=\"n\">open_datasets</span><span class=\"p\">(</span><span class=\"s2\">&quot;era5_july2024_global_hourly.grib&quot;</span><span class=\"p\">)</span>\n<span class=\"n\">ds1</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">[</span><span class=\"mi\">0</span><span class=\"p\">]</span>\n<span class=\"n\">ds2</span> <span class=\"o\">=</span> <span class=\"n\">dataset</span><span class=\"p\">[</span><span class=\"mi\">1</span><span class=\"p\">]</span>\n</code></pre></div>\n\n<p>No Errors! Finally. There were infact two datasets in that file.</p>","metadata":{"date":"Sun, 20 Apr 2025 00:00:00 GMT","slug":"weather-ai-part-2","tags":["python","blog","weather"],"title":"Forecasting Weather (Part 2): Fighting the data"},"slug":"weather-ai-part-2"},{"content_html":"<h1><strong>HELLO WORLD</strong>.</h1>\n<h1>Who am I?</h1>\n<p>I'm a 16-year-old aspiring to break into CS/AI and quantitative finance, but what really matters is that- \nI'm simply someone who has grown to love graphs and data, and the idea of information and analysis.</p>\n<h1>Where I'm coming from:</h1>\n<p>I've been coding (ashamed to call it programming) since I was 11, though I often struggled to see projects through to completion. It wasn't for a lack of ideas- it was a lack of <strong>discipline</strong>. \nTo illustrate the challenges I faced, here are some of my past projects:</p>\n<h2>Project: NoSea</h2>\n<p>This was an overly ambitious one for sure-</p>\n<h3>The Idea:</h3>\n<p>I wanted to make an <strong>operating system (OS) all by myself</strong>... Sounds pretty stupid, right? \nWell it wasn't just another \"Ubuntu reskin\", I wanted to write the kernel and all, by myself. From scratch. <br />\nMy thoughts back then went something like:</p>\n<blockquote>\n<p>If we could have a lightweight, open-source, multi-platform OS (For mobile and PCs), that was the exact same on both platforms (unlike Linux, and android which is based on linux but basically completely different), it would be <strong>\"THE NEXT BIG THING\"</strong></p>\n</blockquote>\n<h3>Resources:</h3>\n<p>Although my project itself wasn't useful at all the resources I used, were.<br />\nSo here are some of them for reference (I can't find all of them as I deleted the repo, and the files. I wasn't logging any of my activities so I can only rely on my memory for this-).    </p>\n<ol>\n<li><a href=\"https://www.youtube.com/playlist?list=PLHh55M_Kq4OApWScZyPl5HhgsTJS9MZ6M\">Write Your Own Operating System (Youtube)</a>: Teaches most of the fundamental and gives an idea about the true complexity of it all. But it's pretty old now, still mostly how systems work- but pretty old.</li>\n<li><a href=\"https://www.youtube.com/playlist?list=PLZQftyCk7_SeZRitx5MjBKzTtvk0pHMtp\">Write Your Own 64-bit Operating System (Youtube - CodePulse)</a>: This is where I made my first mistake. It is a really good example, but I followed it blindly at first, doing exactly what he was without understand the <em>WHY?</em> and the underlying theory. </li>\n<li><a href=\"https://www.youtube.com/playlist?list=PLm3B56ql_akNcvH8vvJRYOc7TbYhRs19M\">Making an OS(x86)</a>: Again a really good resource... but I found it later- after I had nearly given up.   </li>\n<li><a href=\"https://wiki.osdev.org/Expanded_Main_Page\">OSDEV wiki</a>: Literally the Bible for OS dev. Back then, I didnt really understand all the computer stuff and didn't put in enough effort to learn... so I was really confused. Looking back now I can see why it's so highly regarded. </li>\n</ol>\n<h3>The Plan:</h3>\n<p>I didn't have a solid plan at first and ended up failing about 5 or 6 times. (An OS as my first big project was a REALLY BAD idea.) But after all those mess-ups and way too much pondering when I should've been studying, I came up with something. (I'm writing this now, so it's all from memory-I might've made it a bit better by accident, but I've tried to keep the original idea, flaws included.)</p>\n<p><img src=\"/static/images/NoSea-architecture-hello-world.png\" class=\"invertible\">  </p>\n<p>[\n    If you're seeing this- it means I couldn't meet the deadline (01/04/2025), and am too busy/lazy to finish the whole thing. I may update it in the future, but right now my current projects take priority. I hope whatever is written atleast gave you a rough idea about me.\n]</p>","metadata":{"date":"Tue, 01 Apr 2025 00:00:00 GMT","slug":"hello-world","tags":["python","blog"],"title":"Hello World"},"slug":"hello-world"},{"content_html":"<h1>Introduction:</h1>\n<p>Ever wonder why the weather app says there's heavy rain today, while you're sitting under the burning sun? Me too.  <br />\nApparently it's not as easy as one might imagine, what we have today is borderline magic. <br />\nBut still curiosity got the better of me, so I decided to start this project, to uncover what makes it so challenging and maybe learn something along the way.<br />\n<br></p>\n<hr />\n<h1>But How Does Weather Even Work?</h1>\n<p>I remember the weather related chapters used to be some of the most interesting chapters in geography, back in school. Even more so than the science classes (I'm a science student). It was one of those chapters that just made pure logical sense, without overwhelming the students with math.<br />\nTo better understand the numerical observations, we must first qualitatively understand what weather patterns on Earth actually look like. This part will try to cover as much as possible in a reasonable amount of time. (excuse the use of non-technical terms, it's meant to give an idea without getting into the jargon)  </p>\n<h2>The Basic Mechanics:</h2>\n<h3>Convection:</h3>\n<p>Okay so this is typically common-knowledge, but as a refresher, <strong>hot-air is typically lighter (less dense) than cold-air</strong>. This causes hot air to rise up into the atmosphere, causing a <strong>Vertical wind current</strong>.    </p>\n<h3>Drop In Temperature with Height:</h3>\n<p>The temperature usually drops at the <strong>Normal lapse rate</strong> (i.e 6.5 \u00b0C every 1km).<br />\nOne might deem this as common sense, however, the reason is more nuanced than you might think. The atmosphere actually <strong>cannot absorb incoming energy from the sun</strong>, the <strong>heat supply actually comes from the earth</strong> (as it is radiated back into the atmosphere). The main reason has to do with <strong>long and short waves</strong> (terrestrial &amp; solar radiation), but it would require a lot more context to explain. With this highly simplified line of thinking, one can easily imagine the drop in temperature as we get farther away from the surface.</p>\n<h3>Drop In Pressure with Height:</h3>\n<p>Again this is due to the effects of gravity on air. (treating it as a collection of particles).</p>\n<h3>Pressure Differences Drive Wind:</h3>\n<p>Air always moves from <strong>high pressure to low pressure</strong>. Now this pressure difference may be caused in a number of ways, like, <strong>temperature differences</strong> causing hot air to rise, and leaving behind an area of low pressure, or <strong>high relative humidity</strong>, etc.</p>\n<h3>Water Heats/Cools Faster than Land:</h3>\n<p>This gives rise to daily effects like, <strong>land breeze &amp; sea breeze</strong> (due to temperature differences), as well as yearly effects as we will see ahead.</p>\n<h2>Advanced Mechanics:</h2>\n<h3>The Pressure Belts:</h3>\n<p>There are four kinds of pressure belts on earth:    </p>\n<ol>\n<li>Equitorial <strong>LOW</strong> pressure belt (ITCZ).</li>\n<li>Subtropical <strong>HIGH</strong> pressure belt.</li>\n<li>Subpolar <strong>LOW</strong> pressure belt.</li>\n<li>polar <strong>HIGH</strong> pressure belt.</li>\n</ol>\n<p>This image explains it much better than words can:  </p>\n<p><br></p>\n<p><a href=\"https://www.researchgate.net/figure/Ideal-Zonal-Pressure-Belts-An-imaginary-uniform-Earth-with-idealized-zonal-continuous_fig3_273949389\"><img src=\"https://www.researchgate.net/profile/Mesut-Demircan/publication/273949389/figure/fig3/AS:669379721187338@1536603970467/Ideal-Zonal-Pressure-Belts-An-imaginary-uniform-Earth-with-idealized-zonal-continuous.ppm\" alt=\"An imaginary uniform Earth with idealized zonal (continuous) pressure belts.\"/></a></p>\n<p><br></p>\n<p>In essence however, hot air rises at the equator, and cold air descends at the tropics. Same for subpolar and polar, however this time its more to do with the rotation of the earth driving it. (Explaining the whole mechanism will take too much time for a refresher).<br />\nI would also like to bring your attention to the names of these winds, and their direction, it will be important later.</p>\n<h3>Ocean Currents:</h3>\n<p>There are many so look at this figure instead:</p>\n<p><br></p>\n<p><a href=\"https://www.researchgate.net/figure/The-major-ocean-currents-the-red-arrows-illustrate-warm-water-currents-and-the-blue-are_fig2_264880631\"><img src=\"https://www.researchgate.net/profile/Karin-Thomas/publication/264880631/figure/fig2/AS:295907590459392@1447561275071/The-major-ocean-currents-the-red-arrows-illustrate-warm-water-currents-and-the-blue-are.png\" alt=\"The major ocean currents, the red arrows illustrate warm water currents and the blue are cold water currents.\"/></a></p>\n<p><br></p>\n<p>Especially pay attention to the <strong>Peruvian current</strong>. It is infact not a permanent current, it's appearance marks El Nino which will be explored ahead.</p>\n<h3>Rain Shadow &amp; Returning Monsoons:</h3>\n<p>Topological protrusions like mountains can cause significant changes to the local weather. It may block the incoming rain and cause heavy precipitation on the <strong>Windward side</strong>, leaving the other side in <strong>Rain shadow</strong>. \nRain shadow looks something like this:  </p>\n<p><br></p>\n<p><a href=\"https://www.researchgate.net/figure/Precipitation-effects-of-moisture-laden-air-passing-over-a-mountain-range-Precipitation_fig6_226689513\"><img src=\"https://www.researchgate.net/profile/William-Hay-2/publication/226689513/figure/fig6/AS:668988686225415@1536510740573/Precipitation-effects-of-moisture-laden-air-passing-over-a-mountain-range-Precipitation.png\" alt=\"Precipitation effects of moisture-laden air passing over a mountain range. Precipitation occurs on the windward side of the range, and a rain shadow develops in its lee. RH relative humidity\"/></a></p>\n<p><br></p>\n<p>Since we will be doing a lot of heatmap-type graphs later here is a more technical version. (shamelessly copy-pasted, you can read the actual paper linked with it).</p>\n<p><br></p>\n<p><a href=\"https://www.researchgate.net/figure/a-Topography-map-and-location-of-the-measurement-sites-in-the-rain-shadow-region-of-the_fig1_374810410\"><img src=\"https://www.researchgate.net/publication/374810410/figure/fig1/AS:11431281292089982@1732416879462/a-Topography-map-and-location-of-the-measurement-sites-in-the-rain-shadow-region-of-the.png\" alt=\"(a) Topography map and location of the measurement sites in the rain shadow region of the Western Ghats. (b) Hovmoller diagram of the precipitabe water. Hovmoller diagram is generated using hourly averaged data over the region (17\u00b0 N to 20.5\u00b0 N) and (70\u00b0 E to 85\u00b0 E) for the period 25 (00 UTC)-31 (23 UTC) May 2019 (0.5\u2009\u00d7\u20090.625 degree resolution data from MERRA-2 Model M2T1NXLND v5.12.4 product).\"/></a></p>\n<p><br></p>\n<p>Returning Monsoons is a more Indian sub-continent specific term. When the monsoon hit the <strong>himalayas</strong>, they are <strong>blocked</strong> and unable to pass (again excuse the use of non-technical and inaccurate language), and as the sun slowly moves downward the pressure belts start shifting, and the <strong>low pressure zone over the northern plains gets depleted</strong>. This causes the monsoon winds to <strong>blow backwards</strong> making it seem like they are \"retreating\".</p>\n<h3>El Nino and La Nina:</h3>\n<p>El Nino and La Nina are phases of the <strong>El Nino-Southern Oscillation (ENSO)</strong>, driven by shifts in sea surface temperatures and atmospheric pressure across the tropical Pacific. These phases influence global weather patterns, notably the Indian monsoon, by altering wind and moisture flows. The <strong>Peruvian (Humboldt) Current</strong>, a cold ocean current off South America's coast, plays a key role in these dynamics.</p>\n<h4>El Nino Effects</h4>\n<p>During El Nino, weakened trade winds reduce the westward push of warm water, allowing it to flow back toward South America. This warms the eastern Pacific and suppresses the Peruvian Current's cold upwelling, disrupting nutrient-rich waters. For India, this often weakens the monsoon circulation, leading to below-average rainfall and potential droughts, as the usual low-pressure system over the subcontinent loses strength.</p>\n<h4>La Nina Effects</h4>\n<p>In La Nina, stronger trade winds drive warm water toward Asia, intensifying the Peruvian Current's cold upwelling along South America. This cools the eastern Pacific, enhancing atmospheric stability there. For India, La Nina strengthens monsoon winds, increasing moisture inflow from the Indian Ocean, often resulting in above-average rainfall, though excessive rain can cause flooding in vulnerable areas.</p>\n<hr />\n<h1>The Old Way (NWP):</h1>\n<p>We will be exploring this in later posts so it is better not to cover it here.\nAnd honestly, the wikipedia article  <a href=\"https://en.wikipedia.org/wiki/Numerical_weather_prediction\">Numerical Weather Prediction</a> does a better job explaining this than me.</p>\n<p><br>    </p>\n<hr>\n\n<!-- \n# The Old Way: Crunching Numbers\nWay back, predicting weather meant solving big equations-like how fluids move (Navier-Stokes, if you're nerdy). Think of it as slicing the sky into a grid and calculating what happens next. That's numerical weather prediction (NWP). Supercomputers run this for days, tweaking it with real data so it doesn't go off the rails. ERA5, my file, comes from that-past weather re-simulated with today's tech. It's a cheat sheet of what happened in 2024, and I'm using it to jumpstart my own model.\n\nBut here's the catch: those equations are slow, and tiny mistakes explode fast. Chaos, right? That's why I'm not stopping there.\n\n# The New Way: AI's Turn\nThen there's AI. I ran into GenCast-Google's trick from late 2024. It's this crazy model that skips the physics and learns patterns from piles of ERA5 data, spitting out 15-day forecasts in minutes. Wild. Or nowcasting-quick 0-6 hour guesses from radar pics. I'm aiming simpler: a day ahead with a neural network (CNN). Maybe I can nudge it with sparse data later, GenCast-style. It's less \"solve the universe\" and more \"spot the trends\"-faster, scrappier. -->\n\n<h1>Peeking at the Data:</h1>\n<p>So after a few hours of research I stumbled upon <a href=\"https://cds.climate.copernicus.eu/datasets/reanalysis-era5-single-levels?tab=overview\"><strong>ERA5</strong></a>, it's probably the best historical dataset available for free. I did consider trying to get IMD data specific to India, but I guess ERA5 is good enough for a prototype. \nThe dataset on its own is probably very huge (~ few Petabytes), so I decided to get only a few months and a few timestamps worth of data from <strong>2024</strong>, i.e, <strong>Sep, Oct, Nov, Dec</strong>. And roughly <strong>4 hour</strong> intervals.<br />\nThe website conviniently provides it's api guide, as well as auto-generation of the api request. <br />\nhere is the code:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"kn\">import</span><span class=\"w\"> </span><span class=\"nn\">cdsapi</span>\n\n<span class=\"n\">dataset</span> <span class=\"o\">=</span> <span class=\"s2\">&quot;reanalysis-era5-single-levels&quot;</span>\n<span class=\"n\">request</span> <span class=\"o\">=</span> <span class=\"p\">{</span>\n    <span class=\"s2\">&quot;product_type&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"s2\">&quot;reanalysis&quot;</span><span class=\"p\">],</span>\n    <span class=\"s2\">&quot;variable&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"s2\">&quot;10m_u_component_of_wind&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;10m_v_component_of_wind&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;2m_temperature&quot;</span><span class=\"p\">,</span>\n        <span class=\"s2\">&quot;mean_sea_level_pressure&quot;</span>\n    <span class=\"p\">],</span>\n    <span class=\"s2\">&quot;year&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"s2\">&quot;2024&quot;</span><span class=\"p\">],</span>\n    <span class=\"s2\">&quot;month&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"s2\">&quot;09&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;10&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;11&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;12&quot;</span><span class=\"p\">],</span>\n    <span class=\"s2\">&quot;day&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"s2\">&quot;01&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;02&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;03&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;04&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;05&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;06&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;07&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;08&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;09&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;10&quot;</span><span class=\"p\">,</span>\n             <span class=\"s2\">&quot;11&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;12&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;13&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;14&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;15&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;16&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;17&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;18&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;19&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;20&quot;</span><span class=\"p\">,</span>\n             <span class=\"s2\">&quot;21&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;22&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;23&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;24&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;25&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;26&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;27&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;28&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;29&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;30&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;31&quot;</span><span class=\"p\">],</span>\n    <span class=\"s2\">&quot;time&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span><span class=\"s2\">&quot;00:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;01:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;04:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;08:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;12:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;16:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;20:00&quot;</span><span class=\"p\">,</span> <span class=\"s2\">&quot;23:00&quot;</span><span class=\"p\">],</span>\n    <span class=\"s2\">&quot;data_format&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;netcdf&quot;</span><span class=\"p\">,</span>\n    <span class=\"s2\">&quot;download_format&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;unarchived&quot;</span>\n<span class=\"p\">}</span>\n\n<span class=\"n\">client</span> <span class=\"o\">=</span> <span class=\"n\">cdsapi</span><span class=\"o\">.</span><span class=\"n\">Client</span><span class=\"p\">()</span>\n<span class=\"n\">client</span><span class=\"o\">.</span><span class=\"n\">retrieve</span><span class=\"p\">(</span><span class=\"n\">dataset</span><span class=\"p\">,</span> <span class=\"n\">request</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">download</span><span class=\"p\">()</span>\n</code></pre></div>\n\n<p>(NOTE: apparently you're supposed to have a <code>.cdsapirc</code>, for authentication. But it's also supposed to be in <code>$HOME</code>, which makes it worse, and I spent a few hours figuring out how to have everything contained in the project folder itself (didn't work in the end))</p>\n<p>If you didn't notice it yet, this was a really bad idea, here is why:   </p>\n<ul>\n<li>I talked about weather patterns and stuff before, so it's kind of ironic, having <strong>4 consecutive months of weather data</strong> instead of spaced out ones.</li>\n<li>For our use case, we wanted to <strong>Nowcast</strong> i.e predict hourly or even more fine-grained- having our original data itself be spaced by <strong>4 hours</strong>, makes it less than ideal. We might have to either <strong>Re-download</strong> with hourly data, or <strong>interpolate locally</strong> (which seems to be a lot of work) in the future.</li>\n</ul>\n<p>A few other problems exist, but those are the major problems that I might have to tackle in the future. Now, on to the fun part.    </p>\n<p>I did some searching and came across this library called <code>cartopy</code> (<a href=\"https://scitools.org.uk/cartopy/docs/latest/\">link</a>, <a href=\"https://github.com/SciTools/cartopy\">github</a>), that seems to integrate seemlessly with <code>matplotlib</code>, and displays maps.</p>\n<p>Here are some plots:</p>\n<p><br></p>\n<p><img src=\"/static/images/Weatherai/temp_2024-09-30T00-00.png\" class=\"invertible\">\n<br>\n<img src=\"/static/images/Weatherai/temp_2024-09-30T01-00.png\" class=\"invertible\">\n<br>\n<img src=\"/static/images/Weatherai/temp_2024-09-30T04-00.png\" class=\"invertible\">\n<br>\n<img src=\"/static/images/Weatherai/temp_2024-09-30T12-00.png\" class=\"invertible\"></p>\n<p><br></p>\n<p>I got some initial output but It was simply a test and I've already ran into a lot of roadblocks. I am going to have to start from scratch, add total precipitation(tp), total cloud cover (tcc) and possibly switch to GRIB next time. Also have to look at the official docs, and make a project spec. See you next time.</p>\n<p><strong>You can read the next part <a href=\"weather-ai-part-2.html\">here</a></strong></p>","metadata":{"date":"Thu, 10 Apr 2025 00:00:00 GMT","slug":"weather-ai-part-1","tags":["python","blog","weather"],"title":"Forecasting Weather (Part 1): Ideas & Looking At The Data"},"slug":"weather-ai-part-1"}]}
